<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Logan's Results</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f6f7fb; color: #222; }
    .wrap { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
    .card { background: #fff; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,.07); padding: 20px; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #e7e7e7; padding: 8px; text-align: left; font-size: 14px; }
    th { background: #f0f0f0; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }
    h1 { font-size: 28px; margin: 10px 0 20px; }
    h2 { font-size: 20px; margin: 0 0 10px; }
    canvas { width: 100%; height: 260px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Logan â€“ Assessment Results</h1>
      <p>Data from Google Sheets tab: <strong>Logan</strong></p>
    </div>

    <div class="card">
      <h2>All Results (table)</h2>
      <table id="dataTable">
        <thead><tr id="headers"></tr></thead>
        <tbody id="rows"></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Progress Charts</h2>
      <div id="charts" class="grid"></div>
    </div>
  </div>

<script>
  const SHEET_ID = "1dQ6IBSgu54prrWeXDYqsH382GIZ-MwHkq8DRi1zXGeQ";
  const SHEET_NAME = "Logan";

  // Use the gviz CSV endpoint by sheet name (works with "Publish to web")
  const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;

  function parseCSV(text) {
    return text.trim().split(/\r?\n/).map(row => row.split(","));
  }

  function stripQuotes(s) {
    if (s == null) return "";
    return s.replace(/^"|"$/g, "").trim();
  }

  async function loadData() {
    const res = await fetch(SHEET_URL);
    const text = await res.text();
    const rows = parseCSV(text);
    if (!rows.length) return;

    // Clean headers (dates)
    const headers = rows[0].map(stripQuotes);
    const headerRow = document.getElementById("headers");
    headers.forEach(h => {
      const th = document.createElement("th");
      th.textContent = h || "Metric / Date";
      headerRow.appendChild(th);
    });

    // Body rows (clean values for display)
    const tbody = document.getElementById("rows");
    rows.slice(1).forEach(row => {
      if (row.every(c => stripQuotes(c) === "")) return;
      const tr = document.createElement("tr");
      row.forEach(cell => {
        const td = document.createElement("td");
        td.textContent = stripQuotes(cell);
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });

    // Build charts per metric
    const dates = headers.slice(1);
    const chartsDiv = document.getElementById("charts");
    rows.slice(1).forEach((row) => {
      const metric = stripQuotes(row[0]);
      if (!metric) return;
      const values = row.slice(1).map(v => {
        const cleaned = stripQuotes(v);
        const num = parseFloat(cleaned);
        return isNaN(num) ? null : num;
      });

      const container = document.createElement("div");
      container.className = "card";
      const title = document.createElement("h2");
      title.textContent = metric;
      const canvas = document.createElement("canvas");
      container.appendChild(title);
      container.appendChild(canvas);
      chartsDiv.appendChild(container);

      new Chart(canvas.getContext("2d"), {
        type: "line",
        data: {
          labels: dates,
          datasets: [{ label: metric, data: values, fill: true, tension: 0.3 }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    });
  }

  loadData();
</script>
</body>
</html>